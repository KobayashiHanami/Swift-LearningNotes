# 7.0-闭包

闭包是自包含的函数代码块

可以粗暴地理解为 闭包就是没有命名的函数 函数就是有名字的闭包

全局和嵌套函数实际上也是特殊的闭包

就是其他语言中的代码块或匿名函数

闭包是引用类型

闭包的参数列表不能有默认值

闭包可以捕获和存储其所在上下文中任意常量和变量的引用。被称为包裹常量和变量。 Swift 会自动管理在捕获过程中涉及到的所有内存操作。

使用闭包鼓励进行语法优化 能省略的全省略:

- 利用上下文推断参数和返回值类型
- 隐式返回单表达式闭包，即单表达式闭包可以省略 `return` 关键字
- 参数名称缩写
- 尾随闭包语法
- 对于有闭包作为参数的函数，若其最后一个参数 Argument 为闭包，则可以省略参数标签及括号。
- 如果闭包是函数最后一个参数或唯一及参数, 参数可以简写成`$123...`
- 如果有多个参数,只能省略第一个参数名称,比如buttonView

## 1.闭包表达式

闭包表达式是一种构建内联闭包的简洁方式

闭包表达式可以是 `in-out` 参数，但不能设定默认值。

Swift 的闭包表达式拥有简洁的风格，并鼓励在常见场景中进行语法优化，主要优化如下：

- 利用上下文推断参数和返回值类型
- 隐式返回单表达式闭包，即单表达式闭包可以省略 `return` 关键字
- 参数名称缩写,可以直接通过 `$0`，`$1`，`$2`来顺序调用闭包的参数。
- 尾随闭包语法

一般形式：

```swift
{ (parameters) -> return type in
  statements
}
```



## .尾随闭包

尾随闭包是一个书写在函数圆括号之后的闭包表达式

尾随闭包不需要写出它的参数标签

```swift
func saySomething(thing: () -> Void) {thing()}
saySomething (thing: {pring("你瞅啥")})
saySomething () {thing: {pring("你瞅啥")}
saySomething () {(pring("你瞅啥")}
saySomething {(pring("你瞅啥")}
```

## .逃逸闭包

闭包是自包含的函数代码块,用来在代码中被传递和使用。

闭包可以捕获和存储其所在上下文中任意常量和变量的引用,被称为包裹常量和变量。

函数是闭包的一种,函数和闭包都是引用类型。

闭包采用三种形式：

- 全局函数: 是一个有名字但不会捕获任何值的闭包
- 嵌套函数: 是一个有名字并可以捕获其封闭函数域内值的闭包
- 闭包表达式: 是一个利用轻量级语法所写的可以捕获其上下文中变量或常量值的匿名闭包

闭包是精简代码的一种体现，不过常因其省略过多让人觉得不好理解。

可以把闭包理解为没有函数名，甚至可以没有参数名的函数。它常作为函数参数 Argument，用在函数调用过程中。

当一个闭包作为参数传到一个函数中，但是这个闭包在函数返回之后才被执行，我们称该闭包从函数中逃逸。

在参数名之前标注 `@escaping`，用来指明这个闭包是允许“逃逸”出这个函数的。

一种能使闭包“逃逸”出函数的方法是，将这个闭包保存在一个函数外部定义的变量中。

## .高阶函数

有闭包参与的函数,就叫高阶函数

| .sorted |      |
| ------- | ---- |
| .map    |      |
| .reduce |      |
| .filter |      |

## 值捕获

闭包可以在其被定义的上下文中捕获常量或变量。

即使定义这些常量和变量的原作用域已经不存在，闭包仍然可以在闭包函数体内引用和修改这些值。

Swift 中可以捕获值的闭包的最简单形式是嵌套函数，嵌套函数可以捕获其外部函数所有的参数以及定义的常量和变量。

## 自动闭包

```
@autoclosure
```

自动闭包是一种自动创建的闭包，用于包装传递给函数 作为参数的表达式。

这种闭包不接受任何参数，当它被调用的时候，会返回被包装在其中的表达式的值。

这种便利语法让你能够省略闭包的花括号，用一个普通的表达式来代替显式的闭包。

自动闭包让你能够延迟求值，因为直到你调用这个闭包，代码段才会被执行。